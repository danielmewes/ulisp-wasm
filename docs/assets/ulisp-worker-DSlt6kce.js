var nr=Object.defineProperty;var ar=(R,P,j)=>P in R?nr(R,P,{enumerable:!0,configurable:!0,writable:!0,value:j}):R[P]=j;var _e=(R,P,j)=>ar(R,typeof P!="symbol"?P+"":P,j);(function(){"use strict";var R=(()=>{var y;var S=typeof document<"u"?(y=document.currentScript)==null?void 0:y.src:void 0;return(async function(C={}){var v,n=C,F,I,A=new Promise((e,t)=>{F=e,I=t}),d={...n},m=(e,t)=>{throw t},b="";function _(e){return n.locateFile?n.locateFile(e,b):b+e}var D;{if(typeof document<"u"&&document.currentScript&&(b=document.currentScript.src),S&&(b=S),b.startsWith("blob:")?b="":b=b.slice(0,b.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");D=async e=>{o(!he(e),"readAsync does not work with file:// URLs");var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var q=n.print||console.log.bind(console),g=n.printErr||console.error.bind(console);Object.assign(n,d),d=null,Pt(),n.arguments&&n.arguments,O("arguments","arguments_"),n.thisProgram&&n.thisProgram,O("thisProgram","thisProgram"),o(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),o(typeof n.read>"u","Module.read option was removed"),o(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),o(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),o(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),o(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),O("asm","wasmExports"),O("readAsync","readAsync"),O("readBinary","readBinary"),O("setWindowTitle","setWindowTitle"),o(!0,"worker environment detected but not enabled at build time.  Add `worker` to `-sENVIRONMENT` to enable."),o(!0,"node environment detected but not enabled at build time.  Add `node` to `-sENVIRONMENT` to enable."),o(!0,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var X=n.wasmBinary;O("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&g("no native wasm support detected");var se,x=!1,je;function o(e,t){e||w("Assertion failed"+(t?": "+t:""))}var le,G,Z,T,ge,we,ce=!1,he=e=>e.startsWith("file://");function Ge(){var e=Pe();o((e&3)==0),e==0&&(e+=4),T[e>>2]=34821223,T[e+4>>2]=2310721022,T[0]=1668509029}function Q(){if(!x){var e=Pe();e==0&&(e+=4);var t=T[e>>2],r=T[e+4>>2];(t!=34821223||r!=2310721022)&&w(`Stack overflow! Stack cookie has been overwritten at ${Y(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${Y(r)} ${Y(t)}`),T[0]!=1668509029&&w("Runtime error: The application has corrupted its heap memory area (address zero)!")}}if((()=>{var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,t[0]!==115||t[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function O(e,t,r=!0){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){let i=r?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";w(`\`Module.${e}\` has been replaced by \`${t}\``+i)}})}function ee(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,set(){w(`Attempt to set \`Module.${e}\` after it has already been processed.  This can happen, for example, when code is injected via '--post-js' rather than '--pre-js'`)}})}function $e(e){Object.getOwnPropertyDescriptor(n,e)&&w(`\`Module.${e}\` was supplied but \`${e}\` not included in INCOMING_MODULE_JS_API`)}function He(e){return e==="FS_createPath"||e==="FS_createDataFile"||e==="FS_createPreloadedFile"||e==="FS_unlink"||e==="addRunDependency"||e==="FS_createLazyFile"||e==="FS_createDevice"||e==="removeRunDependency"}function ze(e){be(e)}function be(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){var t=`'${e}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;He(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),w(t)}})}function Ye(){var e=se.buffer;n.HEAP8=le=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=G=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=Z=new Int32Array(e),n.HEAPU32=T=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=we=new Float64Array(e),n.HEAP64=ge=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e)}o(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),o(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),o(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),o(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Ve(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)st(n.preRun.shift());ee("preRun"),Se(Ee)}function Je(){o(!ce),ce=!0,Q(),h.__wasm_call_ctors()}function Ke(){if(Q(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)ot(n.postRun.shift());ee("postRun"),Se(Te)}var U=0,$=null,H={},N=null;function qe(e){var t;U++,(t=n.monitorRunDependencies)==null||t.call(n,U),o(!H[e]),H[e]=1,N===null&&typeof setInterval<"u"&&(N=setInterval(()=>{if(x){clearInterval(N),N=null;return}var r=!1;for(var i in H)r||(r=!0,g("still waiting on run dependencies:")),g(`dependency: ${i}`);r&&g("(end of list)")},1e4))}function Xe(e){var r;if(U--,(r=n.monitorRunDependencies)==null||r.call(n,U),o(H[e]),delete H[e],U==0&&(N!==null&&(clearInterval(N),N=null),$)){var t=$;$=null,t()}}function w(e){var r;(r=n.onAbort)==null||r.call(n,e),e="Aborted("+e+")",g(e),x=!0,e.indexOf("RuntimeError: unreachable")>=0&&(e+='. "unreachable" may be due to ASYNCIFY_STACK_SIZE not being large enough (try increasing it)');var t=new WebAssembly.RuntimeError(e);throw I(t),t}var k={error(){w("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init(){k.error()},createDataFile(){k.error()},createPreloadedFile(){k.error()},createLazyFile(){k.error()},open(){k.error()},mkdev(){k.error()},registerDevice(){k.error()},analyzePath(){k.error()},ErrnoError(){k.error()}};n.FS_createDataFile=k.createDataFile,n.FS_createPreloadedFile=k.createPreloadedFile;function p(e,t){return(...r)=>{o(ce,`native function \`${e}\` called before runtime initialization`);var i=h[e];return o(i,`exported native function \`${e}\` not found`),o(r.length<=t,`native function \`${e}\` called with ${r.length} args but expects ${t}`),i(...r)}}var z;function Ze(){return _("ulisp.wasm")}function Qe(e){if(e==z&&X)return new Uint8Array(X);throw"both async and sync fetching of the wasm failed"}async function et(e){if(!X)try{var t=await D(e);return new Uint8Array(t)}catch{}return Qe(e)}async function tt(e,t){try{var r=await et(e),i=await WebAssembly.instantiate(r,t);return i}catch(s){g(`failed to asynchronously prepare wasm: ${s}`),he(z)&&g(`warning: Loading from a file URI (${z}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),w(s)}}async function rt(e,t,r){if(!e&&typeof WebAssembly.instantiateStreaming=="function")try{var i=fetch(t,{credentials:"same-origin"}),s=await WebAssembly.instantiateStreaming(i,r);return s}catch(u){g(`wasm streaming compile failed: ${u}`),g("falling back to ArrayBuffer instantiation")}return tt(t,r)}function nt(){return a.instrumentWasmImports(me),{env:me,wasi_snapshot_preview1:me}}async function at(){function e(l,c){return h=l.exports,h=a.instrumentWasmExports(h),se=h.memory,o(se,"memory not found in wasm exports"),Ye(),Ce=h.__indirect_function_table,o(Ce,"table not found in wasm exports"),Xe("wasm-instantiate"),h}qe("wasm-instantiate");var t=n;function r(l){return o(n===t,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),t=null,e(l.instance)}var i=nt();if(n.instantiateWasm)return new Promise((l,c)=>{try{n.instantiateWasm(i,(f,L)=>{e(f,L),l(f.exports)})}catch(f){g(`Module.instantiateWasm callback failed with error: ${f}`),c(f)}});z??(z=Ze());try{var s=await rt(X,z,i),u=r(s);return u}catch(l){return I(l),Promise.reject(l)}}class it{constructor(t){_e(this,"name","ExitStatus");this.message=`Program terminated with exit(${t})`,this.status=t}}var Se=e=>{for(;e.length>0;)e.shift()(n)},Te=[],ot=e=>Te.unshift(e),Ee=[],st=e=>Ee.unshift(e);n.noExitRuntime;var Y=e=>(o(typeof e=="number"),e>>>=0,"0x"+e.toString(16).padStart(8,"0")),V=e=>Bt(e),J=()=>Le(),W=e=>{W.shown||(W.shown={}),W.shown[e]||(W.shown[e]=1,g(e))},Fe=typeof TextDecoder<"u"?new TextDecoder:void 0,Ae=(e,t=0,r=NaN)=>{for(var i=t+r,s=t;e[s]&&!(s>=i);)++s;if(s-t>16&&e.buffer&&Fe)return Fe.decode(e.subarray(t,s));for(var u="";t<s;){var l=e[t++];if(!(l&128)){u+=String.fromCharCode(l);continue}var c=e[t++]&63;if((l&224)==192){u+=String.fromCharCode((l&31)<<6|c);continue}var f=e[t++]&63;if((l&240)==224?l=(l&15)<<12|c<<6|f:((l&248)!=240&&W("Invalid UTF-8 leading byte "+Y(l)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),l=(l&7)<<18|c<<12|f<<6|e[t++]&63),l<65536)u+=String.fromCharCode(l);else{var L=l-65536;u+=String.fromCharCode(55296|L>>10,56320|L&1023)}}return u},M=(e,t)=>(o(typeof e=="number",`UTF8ToString expects a number (got ${typeof e})`),e?Ae(G,e,t):""),lt=(e,t,r,i)=>w(`Assertion failed: ${M(e)}, at: `+[t?M(t):"unknown filename",r,i?M(i):"unknown function"]),ct=()=>w("native code called abort()"),ut=()=>{throw 1/0},te=[],dt=(e,t)=>{o(Array.isArray(te)),o(t%16==0),te.length=0;for(var r;r=G[e++];){var i=String.fromCharCode(r),s=["d","f","i","p"];s.push("j"),o(s.includes(i),`Invalid character ${r}("${i}") in readEmAsmArgs! Use only [${s}], and do not specify "v" for void return argument.`);var u=r!=105;u&=r!=112,t+=u&&t%8?4:0,te.push(r==112?T[t>>2]:r==106?ge[t>>3]:r==105?Z[t>>2]:we[t>>3]),t+=u?8:4}return te},ke=(e,t,r)=>{var i=dt(t,r);return o(Re.hasOwnProperty(e),`No EM_ASM constant found at address ${e}.  The loaded WebAssembly file is likely out of sync with the generated JavaScript.`),Re[e](...i)},ft=(e,t,r)=>ke(e,t,r),mt=(e,t,r)=>ke(e,t,r),pt=e=>{w(`Cannot enlarge memory arrays to size ${e} bytes (OOM). Either (1) compile with -sINITIAL_MEMORY=X with X higher than the current value ${le.length}, (2) compile with -sALLOW_MEMORY_GROWTH which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with -sABORTING_MALLOC=0`)},yt=e=>{G.length,e>>>=0,pt(e)},vt=e=>{w("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")};function _t(e,t,r,i){return 70}var gt=[null,[],[]],wt=(e,t)=>{var r=gt[e];o(r),t===0||t===10?((e===1?q:g)(Ae(r)),r.length=0):r.push(t)},ht=(e,t,r,i)=>{for(var s=0,u=0;u<r;u++){var l=T[t>>2],c=T[t+4>>2];t+=8;for(var f=0;f<c;f++)wt(e,G[l+f]);s+=c}return T[i>>2]=s,0},Ce,re=e=>{try{return e()}catch(t){w(t)}},bt=e=>{if(e instanceof it||e=="unwind")return je;Q(),e instanceof WebAssembly.RuntimeError&&Le()<=0&&g("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 65536)"),m(1,e)},ue=0,St=()=>{},Tt=e=>{if(x){g("user callback triggered after runtime exited or application aborted.  Ignoring.");return}try{e(),St()}catch(t){bt(t)}},Et=()=>{ue+=1},Ft=()=>{o(ue>0),ue-=1},a={instrumentWasmImports(e){var t=/^(invoke_.*|__asyncjs__.*)$/;for(let[r,i]of Object.entries(e))if(typeof i=="function"){let s=i.isAsync||t.test(r);e[r]=(...u)=>{var l=a.state;try{return i(...u)}finally{var c=l===a.State.Normal&&a.state===a.State.Disabled,f=r.startsWith("invoke_")&&!0;if(a.state!==l&&!s&&!c&&!f)throw new Error(`import ${r} was not in ASYNCIFY_IMPORTS, but changed the state`)}}}},instrumentWasmExports(e){var t={};for(let[r,i]of Object.entries(e))typeof i=="function"?t[r]=(...s)=>{a.exportCallStack.push(r);try{return i(...s)}finally{if(!x){var u=a.exportCallStack.pop();o(u===r),a.maybeStopUnwind()}}}:t[r]=i;return t},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var t=a.callStackNameToId[e];return t===void 0&&(t=a.callStackId++,a.callStackNameToId[e]=t,a.callStackIdToName[t]=e),t},maybeStopUnwind(){a.currData&&a.state===a.State.Unwinding&&a.exportCallStack.length===0&&(a.state=a.State.Normal,re(Vt),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return o(a.currData,"Tried to wait for an async operation when none is in progress."),o(!a.asyncPromiseHandlers,"Cannot have multiple async operations in flight at once"),new Promise((e,t)=>{a.asyncPromiseHandlers={resolve:e,reject:t}})},allocateData(){var e=pe(12+a.StackSize);return a.setDataHeader(e,e+12,a.StackSize),a.setDataRewindFunc(e),e},setDataHeader(e,t,r){T[e>>2]=t,T[e+4>>2]=t+r},setDataRewindFunc(e){var t=a.exportCallStack[0],r=a.getCallStackId(t);Z[e+8>>2]=r},getDataRewindFuncName(e){var t=Z[e+8>>2],r=a.callStackIdToName[t];return r},getDataRewindFunc(e){var t=h[e];return t},doRewind(e){var t=a.getDataRewindFuncName(e),r=a.getDataRewindFunc(t);return r()},handleSleep(e){if(o(a.state!==a.State.Disabled,"Asyncify cannot be done during or after the runtime exits"),!x){if(a.state===a.State.Normal){var t=!1,r=!1;e((i=0)=>{if(o(!i||typeof i=="number"||typeof i=="boolean"),!x&&(a.handleSleepReturnValue=i,t=!0,!!r)){o(!a.exportCallStack.length,"Waking up (starting to rewind) must be done from JS, without compiled code on the stack."),a.state=a.State.Rewinding,re(()=>Jt(a.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var s,u=!1;try{s=a.doRewind(a.currData)}catch(f){s=f,u=!0}var l=!1;if(!a.currData){var c=a.asyncPromiseHandlers;c&&(a.asyncPromiseHandlers=null,(u?c.reject:c.resolve)(s),l=!0)}if(u&&!l)throw s}}),r=!0,t||(a.state=a.State.Unwinding,a.currData=a.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),re(()=>Yt(a.currData)))}else a.state===a.State.Rewinding?(a.state=a.State.Normal,re(Kt),Nt(a.currData),a.currData=null,a.sleepCallbacks.forEach(Tt)):w(`invalid state: ${a.state}`);return a.handleSleepReturnValue}},handleAsync(e){return a.handleSleep(t=>{e().then(t).catch(()=>{})})}},At=e=>{var t=n["_"+e];return o(t,"Cannot call unknown function "+e+", make sure it is exported"),t},kt=(e,t)=>{o(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),le.set(e,t)},de=e=>{for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i<=127?t++:i<=2047?t+=2:i>=55296&&i<=57343?(t+=4,++r):t+=3}return t},Ct=(e,t,r,i)=>{if(o(typeof e=="string",`stringToUTF8Array expects a string (got ${typeof e})`),!(i>0))return 0;for(var s=r,u=r+i-1,l=0;l<e.length;++l){var c=e.charCodeAt(l);if(c>=55296&&c<=57343){var f=e.charCodeAt(++l);c=65536+((c&1023)<<10)|f&1023}if(c<=127){if(r>=u)break;t[r++]=c}else if(c<=2047){if(r+1>=u)break;t[r++]=192|c>>6,t[r++]=128|c&63}else if(c<=65535){if(r+2>=u)break;t[r++]=224|c>>12,t[r++]=128|c>>6&63,t[r++]=128|c&63}else{if(r+3>=u)break;c>1114111&&W("Invalid Unicode code point "+Y(c)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|c>>18,t[r++]=128|c>>12&63,t[r++]=128|c>>6&63,t[r++]=128|c&63}}return t[r]=0,r-s},fe=(e,t,r)=>(o(typeof r=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),Ct(e,G,t,r)),Ie=e=>jt(e),It=e=>{var t=de(e)+1,r=Ie(t);return fe(e,r,t),r},Me=(e,t,r,i,s)=>{var u={string:E=>{var K=0;return E!=null&&E!==0&&(K=It(E)),K},array:E=>{var K=Ie(E.length);return kt(E,K),K}};function l(E){return t==="string"?M(E):t==="boolean"?!!E:E}var c=At(e),f=[],L=0;if(o(t!=="array",'Return type should not be "array".'),i)for(var B=0;B<i.length;B++){var xe=u[r[B]];xe?(L===0&&(L=J()),f[B]=xe(i[B])):f[B]=i[B]}var ve=a.currData,ae=c(...f);function Oe(E){return Ft(),L!==0&&V(L),l(E)}var Ue=s==null?void 0:s.async;return Et(),a.currData!=ve?(o(!(ve&&a.currData),"We cannot start an async operation when one is already flight"),o(!(ve&&!a.currData),"We cannot stop an async operation in flight"),o(Ue,"The call to "+e+" is running asynchronously. If this was intended, add the async option to the ccall/cwrap call."),a.whenDone().then(Oe)):(ae=Oe(ae),Ue?Promise.resolve(ae):ae)},Mt=(e,t,r,i)=>(...s)=>Me(e,t,r,s,i),Rt=e=>{var t=de(e)+1,r=pe(t);return r&&fe(e,r,t),r};function Pt(){$e("fetchSettings")}var Re={54768:()=>performance.now(),54798:e=>performance.now()-e,54833:(e,t)=>globalThis.ulisp.call(M(e),t),54889:(e,t,r)=>{globalThis.ulisp.call(M(e),t,r)},54942:(e,t)=>globalThis.ulisp.call(M(e),t),54998:(e,t,r)=>{globalThis.ulisp.call(M(e),t,r)},55051:(e,t,r)=>{globalThis.ulisp.call(M(e),t,r)}};function Lt(e){return a.handleAsync(async()=>{await globalThis.ulisp.delay(e)})}function Dt(){return a.handleAsync(async()=>{const e=await globalThis.ulisp.readLine(),t=de(e)+1,r=pe(t);return fe(e,r,t),r})}function xt(e){return a.handleAsync(async()=>{const t=await globalThis.ulisp.readByte(e);return t===-1?-1:t<0||t>255?(console.error("Invalid byte generated",t),-1):t})}function Ot(e,t){globalThis.ulisp.writeByte(e,t)}function Ut(){return globalThis.ulisp.wait_for_tick()}var me={__assert_fail:lt,__asyncjs__delay_on_host:Lt,__asyncjs__read_byte_from_host:xt,__asyncjs__read_line_from_host:Dt,_abort_js:ct,_emscripten_throw_longjmp:ut,emscripten_asm_const_double:ft,emscripten_asm_const_int:mt,emscripten_resize_heap:yt,fd_close:vt,fd_seek:_t,fd_write:ht,invoke_ii:Xt,invoke_iii:Zt,invoke_vi:Qt,invoke_vii:qt,wait_for_tick_on_host:Ut,write_byte_to_host:Ot},h=await at(),Nt=n._free=p("free",1);n._print_version=p("print_version",0),n._setup=p("setup",0),n._stop_loop=p("stop_loop",0),n._evaluate=p("evaluate",1);var pe=p("malloc",1),ne=p("setThrew",2),Wt=h.emscripten_stack_init;h.emscripten_stack_get_free,h.emscripten_stack_get_base;var Pe=h.emscripten_stack_get_end,Bt=h._emscripten_stack_restore,jt=h._emscripten_stack_alloc,Le=h.emscripten_stack_get_current,Gt=n.dynCall_vi=p("dynCall_vi",2);n.dynCall_i=p("dynCall_i",1);var $t=n.dynCall_vii=p("dynCall_vii",3),Ht=n.dynCall_ii=p("dynCall_ii",2),zt=n.dynCall_iii=p("dynCall_iii",3);n.dynCall_iiii=p("dynCall_iiii",4),n.dynCall_jiji=p("dynCall_jiji",4);var Yt=p("asyncify_start_unwind",1),Vt=p("asyncify_stop_unwind",0),Jt=p("asyncify_start_rewind",1),Kt=p("asyncify_stop_rewind",0);function qt(e,t,r){var i=J();try{$t(e,t,r)}catch(s){if(V(i),s!==s+0)throw s;ne(1,0)}}function Xt(e,t){var r=J();try{return Ht(e,t)}catch(i){if(V(r),i!==i+0)throw i;ne(1,0)}}function Zt(e,t,r){var i=J();try{return zt(e,t,r)}catch(s){if(V(i),s!==s+0)throw s;ne(1,0)}}function Qt(e,t){var r=J();try{Gt(e,t)}catch(i){if(V(r),i!==i+0)throw i;ne(1,0)}}n.ccall=Me,n.cwrap=Mt,n.UTF8ToString=M,n.stringToNewUTF8=Rt;var er=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getTempRet0","setTempRet0","zeroMemory","growMemory","strError","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","runMainThreadEmAsm","jstoi_q","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","asmjsMangle","asyncLoad","mmapAlloc","HandleAllocator","getNativeTypeSize","addOnInit","addOnPostCtor","addOnPreMain","addOnExit","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","uleb128Encode","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","getEnvStrings","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","initRandomFill","randomFill","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","ExceptionInfo","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar","FS_unlink","FS_createDataFile","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];er.forEach(ze);var tr=["run","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","INT53_MAX","INT53_MIN","bigintToI53Checked","stackSave","stackRestore","stackAlloc","ptrToString","exitJS","getHeapMax","abortOnCannotGrowMemory","ENV","ERRNO_CODES","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","readEmAsmArgs","runEmAsmFunction","jstoi_s","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","alignMemory","wasmTable","noExitRuntime","addOnPreRun","addOnPostRun","getCFunc","sigToWasmTypes","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","UTF16Decoder","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","flush_NO_FILESYSTEM","emSetImmediate","emClearImmediate_deps","emClearImmediate","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_stdin_getChar_buffer","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","runAndAbortIfError","Asyncify","Fibers","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];tr.forEach(be);var De;function rr(){Wt(),Ge()}function ye(){if(U>0){$=ye;return}if(rr(),Ve(),U>0){$=ye;return}function e(){var t;o(!De),De=!0,n.calledRun=!0,!x&&(Je(),F(n),(t=n.onRuntimeInitialized)==null||t.call(n),ee("onRuntimeInitialized"),o(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Ke())}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e(),Q()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();ee("preInit"),ye(),v=A;for(const e of Object.keys(n))e in C||Object.defineProperty(C,e,{configurable:!0,get(){w(`Access to module property ('${e}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return v})})();(()=>{var S=R;R=function(y){if(new.target)throw new Error("createLispWasmModule() should not be called with `new createLispWasmModule()`");return S(y)}})();var P=R;class j{constructor(){_e(this,"buffer","")}start(){this.buffer=""}push(y){this.buffer+=y}end(){let y=this.buffer.trimEnd();return this.buffer="",y}}async function Ne({createLispWasmModule:S,print:y,printError:C}){const v=new j;function n(...A){if(y)return y(...A);v.push(A.reduce((d,m)=>(d+=m,d),""))}const F=await S({print:n,printErr:C||n});F._setup();async function I(A){v.start();const d=F.stringToNewUTF8(`(progn ${A})`);await F.ccall("evaluate","void",["number"],[d],{async:!0}),F._free(d);const m=v.end();if(m==="nil")return null;if(m==="t")return!0;try{return JSON.parse(m)}catch{return m}}return{eval:I}}async function We(S={}){const{wasmPath:y="",tick:C,print:v,printError:n,readByte:F,writeByte:I,readLine:A}=S;return globalThis.ulisp={call(d,...m){switch(console.log("ulisp called",d,...m),d){case"analogRead":return 0;case"analogWrite":break;case"digitalRead":return 0}},async delay(d=0){return new Promise((m,b)=>{console.log("delay",d),setTimeout(m,parseInt(d,10))})},async readByte(d){return F?await F(d):""},writeByte(d,m){I&&I(d,m)},async readLine(){return A?await A():""},writeLine(d){v&&v(d)},writeLineError(d){n?n(d):v&&v(d)},escape(){return 0},wait_for_tick(){if(C)return C()},stop(){}},await Ne({print:v,printError:n||v,createLispWasmModule(d={}){return P({...d,locateFile(m,b){return y+m}})}})}let ie;const oe=new Map;async function Be(S){const{id:y,data:C,action:v,response:n}=S.data;if(v==="response"){const _=oe.get(y);_&&(_(n),oe.delete(y));return}if(v){console.log("Action",v);return}const{code:F,wasmPath:I=""}=C;let A=0;function d(_,...D){const q=`request-${Date.now()}-${Math.random()}`;return self.postMessage({requestId:q,action:_,args:D}),new Promise(g=>{oe.set(q,g)})}function m(_,...D){self.postMessage({action:_,args:D})}ie||(ie=await We({wasmPath:I,tick(){A++,self.postMessage({step:A})},print(_){self.postMessage({print:_})},printError(_){self.postMessage({printError:_})},readByte(_){return d("readByte",_)},readLine(){return d("readLine")},async writeByte(_,D){return m("writeByte",_,D)}}));const b=await ie.eval(F);self.postMessage({id:y,result:b})}self.addEventListener("message",function(S){Be(S)})})();
