var Qt=Object.defineProperty;var er=(k,C,U)=>C in k?Qt(k,C,{enumerable:!0,configurable:!0,writable:!0,value:U}):k[C]=U;var ce=(k,C,U)=>er(k,typeof C!="symbol"?C+"":C,U);(function(){"use strict";var k=(()=>{var p;var _=typeof document<"u"?(p=document.currentScript)==null?void 0:p.src:void 0;return async function(S={}){var f,n=S,E,b,F=new Promise((e,t)=>{E=e,b=t}),te={...n},Ue=(e,t)=>{throw t},I="";function Ne(e){return n.locateFile?n.locateFile(e,I):I+e}var ue;{if(typeof document<"u"&&document.currentScript&&(I=document.currentScript.src),_&&(I=_),I.startsWith("blob:")?I="":I=I.slice(0,I.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");ue=async e=>{o(!me(e),"readAsync does not work with file:// URLs");var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var We=n.print||console.log.bind(console),g=n.printErr||console.error.bind(console);Object.assign(n,te),te=null,Mt(),n.arguments&&n.arguments,P("arguments","arguments_"),n.thisProgram&&n.thisProgram,P("thisProgram","thisProgram"),o(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),o(typeof n.read>"u","Module.read option was removed"),o(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),o(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),o(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),o(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),P("asm","wasmExports"),P("readAsync","readAsync"),P("readBinary","readBinary"),P("setWindowTitle","setWindowTitle"),o(!0,"worker environment detected but not enabled at build time.  Add `worker` to `-sENVIRONMENT` to enable."),o(!0,"node environment detected but not enabled at build time.  Add `node` to `-sENVIRONMENT` to enable."),o(!0,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var Y=n.wasmBinary;P("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&g("no native wasm support detected");var re,M=!1,Be;function o(e,t){e||y("Assertion failed"+(t?": "+t:""))}var ne,N,V,h,de,fe,ae=!1,me=e=>e.startsWith("file://");function Ge(){var e=Ce();o((e&3)==0),e==0&&(e+=4),h[e>>2]=34821223,h[e+4>>2]=2310721022,h[0]=1668509029}function J(){if(!M){var e=Ce();e==0&&(e+=4);var t=h[e>>2],r=h[e+4>>2];(t!=34821223||r!=2310721022)&&y(`Stack overflow! Stack cookie has been overwritten at ${j(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${j(r)} ${j(t)}`),h[0]!=1668509029&&y("Runtime error: The application has corrupted its heap memory area (address zero)!")}}if((()=>{var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,t[0]!==115||t[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function P(e,t,r=!0){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){let i=r?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";y(`\`Module.${e}\` has been replaced by \`${t}\``+i)}})}function K(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,set(){y(`Attempt to set \`Module.${e}\` after it has already been processed.  This can happen, for example, when code is injected via '--post-js' rather than '--pre-js'`)}})}function je(e){Object.getOwnPropertyDescriptor(n,e)&&y(`\`Module.${e}\` was supplied but \`${e}\` not included in INCOMING_MODULE_JS_API`)}function He(e){return e==="FS_createPath"||e==="FS_createDataFile"||e==="FS_createPreloadedFile"||e==="FS_unlink"||e==="addRunDependency"||e==="FS_createLazyFile"||e==="FS_createDevice"||e==="removeRunDependency"}function $e(e){pe(e)}function pe(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){var t=`'${e}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;He(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),y(t)}})}function ze(){var e=re.buffer;n.HEAP8=ne=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=N=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=V=new Int32Array(e),n.HEAPU32=h=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=fe=new Float64Array(e),n.HEAP64=de=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e)}o(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),o(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),o(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),o(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Ye(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)ot(n.preRun.shift());K("preRun"),ye(ge)}function Ve(){o(!ae),ae=!0,J(),v.__wasm_call_ctors()}function Je(){if(J(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)it(n.postRun.shift());K("postRun"),ye(ve)}var D=0,W=null,B={},x=null;function Ke(e){var t;D++,(t=n.monitorRunDependencies)==null||t.call(n,D),o(!B[e]),B[e]=1,x===null&&typeof setInterval<"u"&&(x=setInterval(()=>{if(M){clearInterval(x),x=null;return}var r=!1;for(var i in B)r||(r=!0,g("still waiting on run dependencies:")),g(`dependency: ${i}`);r&&g("(end of list)")},1e4))}function Xe(e){var r;if(D--,(r=n.monitorRunDependencies)==null||r.call(n,D),o(B[e]),delete B[e],D==0&&(x!==null&&(clearInterval(x),x=null),W)){var t=W;W=null,t()}}function y(e){var r;(r=n.onAbort)==null||r.call(n,e),e="Aborted("+e+")",g(e),M=!0,e.indexOf("RuntimeError: unreachable")>=0&&(e+='. "unreachable" may be due to ASYNCIFY_STACK_SIZE not being large enough (try increasing it)');var t=new WebAssembly.RuntimeError(e);throw b(t),t}var T={error(){y("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init(){T.error()},createDataFile(){T.error()},createPreloadedFile(){T.error()},createLazyFile(){T.error()},open(){T.error()},mkdev(){T.error()},registerDevice(){T.error()},analyzePath(){T.error()},ErrnoError(){T.error()}};n.FS_createDataFile=T.createDataFile,n.FS_createPreloadedFile=T.createPreloadedFile;function m(e,t){return(...r)=>{o(ae,`native function \`${e}\` called before runtime initialization`);var i=v[e];return o(i,`exported native function \`${e}\` not found`),o(r.length<=t,`native function \`${e}\` called with ${r.length} args but expects ${t}`),i(...r)}}var G;function Ze(){return Ne("ulisp.wasm")}function qe(e){if(e==G&&Y)return new Uint8Array(Y);throw"both async and sync fetching of the wasm failed"}async function Qe(e){if(!Y)try{var t=await ue(e);return new Uint8Array(t)}catch{}return qe(e)}async function et(e,t){try{var r=await Qe(e),i=await WebAssembly.instantiate(r,t);return i}catch(s){g(`failed to asynchronously prepare wasm: ${s}`),me(G)&&g(`warning: Loading from a file URI (${G}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),y(s)}}async function tt(e,t,r){if(!e&&typeof WebAssembly.instantiateStreaming=="function")try{var i=fetch(t,{credentials:"same-origin"}),s=await WebAssembly.instantiateStreaming(i,r);return s}catch(u){g(`wasm streaming compile failed: ${u}`),g("falling back to ArrayBuffer instantiation")}return et(t,r)}function rt(){return a.instrumentWasmImports(oe),{env:oe,wasi_snapshot_preview1:oe}}async function nt(){function e(l,c){return v=l.exports,v=a.instrumentWasmExports(v),re=v.memory,o(re,"memory not found in wasm exports"),ze(),be=v.__indirect_function_table,o(be,"table not found in wasm exports"),Xe("wasm-instantiate"),v}Ke("wasm-instantiate");var t=n;function r(l){return o(n===t,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),t=null,e(l.instance)}var i=rt();if(n.instantiateWasm)return new Promise((l,c)=>{try{n.instantiateWasm(i,(d,R)=>{e(d,R),l(d.exports)})}catch(d){g(`Module.instantiateWasm callback failed with error: ${d}`),c(d)}});G??(G=Ze());try{var s=await tt(Y,G,i),u=r(s);return u}catch(l){return b(l),Promise.reject(l)}}class at{constructor(t){ce(this,"name","ExitStatus");this.message=`Program terminated with exit(${t})`,this.status=t}}var ye=e=>{for(;e.length>0;)e.shift()(n)},ve=[],it=e=>ve.unshift(e),ge=[],ot=e=>ge.unshift(e);n.noExitRuntime;var j=e=>(o(typeof e=="number"),e>>>=0,"0x"+e.toString(16).padStart(8,"0")),H=e=>Ot(e),$=()=>Ie(),L=e=>{L.shown||(L.shown={}),L.shown[e]||(L.shown[e]=1,g(e))},_e=typeof TextDecoder<"u"?new TextDecoder:void 0,he=(e,t=0,r=NaN)=>{for(var i=t+r,s=t;e[s]&&!(s>=i);)++s;if(s-t>16&&e.buffer&&_e)return _e.decode(e.subarray(t,s));for(var u="";t<s;){var l=e[t++];if(!(l&128)){u+=String.fromCharCode(l);continue}var c=e[t++]&63;if((l&224)==192){u+=String.fromCharCode((l&31)<<6|c);continue}var d=e[t++]&63;if((l&240)==224?l=(l&15)<<12|c<<6|d:((l&248)!=240&&L("Invalid UTF-8 leading byte "+j(l)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),l=(l&7)<<18|c<<12|d<<6|e[t++]&63),l<65536)u+=String.fromCharCode(l);else{var R=l-65536;u+=String.fromCharCode(55296|R>>10,56320|R&1023)}}return u},A=(e,t)=>(o(typeof e=="number",`UTF8ToString expects a number (got ${typeof e})`),e?he(N,e,t):""),st=(e,t,r,i)=>y(`Assertion failed: ${A(e)}, at: `+[t?A(t):"unknown filename",r,i?A(i):"unknown function"]),lt=()=>y("native code called abort()"),ct=()=>{throw 1/0},X=[],ut=(e,t)=>{o(Array.isArray(X)),o(t%16==0),X.length=0;for(var r;r=N[e++];){var i=String.fromCharCode(r),s=["d","f","i","p"];s.push("j"),o(s.includes(i),`Invalid character ${r}("${i}") in readEmAsmArgs! Use only [${s}], and do not specify "v" for void return argument.`);var u=r!=105;u&=r!=112,t+=u&&t%8?4:0,X.push(r==112?h[t>>2]:r==106?de[t>>3]:r==105?V[t>>2]:fe[t>>3]),t+=u?8:4}return X},we=(e,t,r)=>{var i=ut(t,r);return o(Ae.hasOwnProperty(e),`No EM_ASM constant found at address ${e}.  The loaded WebAssembly file is likely out of sync with the generated JavaScript.`),Ae[e](...i)},dt=(e,t,r)=>we(e,t,r),ft=(e,t,r)=>we(e,t,r),mt=e=>{y(`Cannot enlarge memory arrays to size ${e} bytes (OOM). Either (1) compile with -sINITIAL_MEMORY=X with X higher than the current value ${ne.length}, (2) compile with -sALLOW_MEMORY_GROWTH which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with -sABORTING_MALLOC=0`)},pt=e=>{N.length,e>>>=0,mt(e)},yt=e=>{y("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")};function vt(e,t,r,i){return 70}var gt=[null,[],[]],_t=(e,t)=>{var r=gt[e];o(r),t===0||t===10?((e===1?We:g)(he(r)),r.length=0):r.push(t)},ht=(e,t,r,i)=>{for(var s=0,u=0;u<r;u++){var l=h[t>>2],c=h[t+4>>2];t+=8;for(var d=0;d<c;d++)_t(e,N[l+d]);s+=c}return h[i>>2]=s,0},be,Z=e=>{try{return e()}catch(t){y(t)}},wt=e=>{if(e instanceof at||e=="unwind")return Be;J(),e instanceof WebAssembly.RuntimeError&&Ie()<=0&&g("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 65536)"),Ue(1,e)},ie=0,bt=()=>{},St=e=>{if(M){g("user callback triggered after runtime exited or application aborted.  Ignoring.");return}try{e(),bt()}catch(t){wt(t)}},Tt=()=>{ie+=1},Et=()=>{o(ie>0),ie-=1},a={instrumentWasmImports(e){var t=/^(invoke_.*|__asyncjs__.*)$/;for(let[r,i]of Object.entries(e))if(typeof i=="function"){let s=i.isAsync||t.test(r);e[r]=(...u)=>{var l=a.state;try{return i(...u)}finally{var c=l===a.State.Normal&&a.state===a.State.Disabled,d=r.startsWith("invoke_")&&!0;if(a.state!==l&&!s&&!c&&!d)throw new Error(`import ${r} was not in ASYNCIFY_IMPORTS, but changed the state`)}}}},instrumentWasmExports(e){var t={};for(let[r,i]of Object.entries(e))typeof i=="function"?t[r]=(...s)=>{a.exportCallStack.push(r);try{return i(...s)}finally{if(!M){var u=a.exportCallStack.pop();o(u===r),a.maybeStopUnwind()}}}:t[r]=i;return t},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var t=a.callStackNameToId[e];return t===void 0&&(t=a.callStackId++,a.callStackNameToId[e]=t,a.callStackIdToName[t]=e),t},maybeStopUnwind(){a.currData&&a.state===a.State.Unwinding&&a.exportCallStack.length===0&&(a.state=a.State.Normal,Z(Ht),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return o(a.currData,"Tried to wait for an async operation when none is in progress."),o(!a.asyncPromiseHandlers,"Cannot have multiple async operations in flight at once"),new Promise((e,t)=>{a.asyncPromiseHandlers={resolve:e,reject:t}})},allocateData(){var e=ke(12+a.StackSize);return a.setDataHeader(e,e+12,a.StackSize),a.setDataRewindFunc(e),e},setDataHeader(e,t,r){h[e>>2]=t,h[e+4>>2]=t+r},setDataRewindFunc(e){var t=a.exportCallStack[0],r=a.getCallStackId(t);V[e+8>>2]=r},getDataRewindFuncName(e){var t=V[e+8>>2],r=a.callStackIdToName[t];return r},getDataRewindFunc(e){var t=v[e];return t},doRewind(e){var t=a.getDataRewindFuncName(e),r=a.getDataRewindFunc(t);return r()},handleSleep(e){if(o(a.state!==a.State.Disabled,"Asyncify cannot be done during or after the runtime exits"),!M){if(a.state===a.State.Normal){var t=!1,r=!1;e((i=0)=>{if(o(!i||typeof i=="number"||typeof i=="boolean"),!M&&(a.handleSleepReturnValue=i,t=!0,!!r)){o(!a.exportCallStack.length,"Waking up (starting to rewind) must be done from JS, without compiled code on the stack."),a.state=a.State.Rewinding,Z(()=>$t(a.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var s,u=!1;try{s=a.doRewind(a.currData)}catch(d){s=d,u=!0}var l=!1;if(!a.currData){var c=a.asyncPromiseHandlers;c&&(a.asyncPromiseHandlers=null,(u?c.reject:c.resolve)(s),l=!0)}if(u&&!l)throw s}}),r=!0,t||(a.state=a.State.Unwinding,a.currData=a.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),Z(()=>jt(a.currData)))}else a.state===a.State.Rewinding?(a.state=a.State.Normal,Z(zt),xt(a.currData),a.currData=null,a.sleepCallbacks.forEach(St)):y(`invalid state: ${a.state}`);return a.handleSleepReturnValue}},handleAsync(e){return a.handleSleep(t=>{e().then(t).catch(()=>{})})}},Ft=e=>{var t=n["_"+e];return o(t,"Cannot call unknown function "+e+", make sure it is exported"),t},At=(e,t)=>{o(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),ne.set(e,t)},Se=e=>{for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i<=127?t++:i<=2047?t+=2:i>=55296&&i<=57343?(t+=4,++r):t+=3}return t},kt=(e,t,r,i)=>{if(o(typeof e=="string",`stringToUTF8Array expects a string (got ${typeof e})`),!(i>0))return 0;for(var s=r,u=r+i-1,l=0;l<e.length;++l){var c=e.charCodeAt(l);if(c>=55296&&c<=57343){var d=e.charCodeAt(++l);c=65536+((c&1023)<<10)|d&1023}if(c<=127){if(r>=u)break;t[r++]=c}else if(c<=2047){if(r+1>=u)break;t[r++]=192|c>>6,t[r++]=128|c&63}else if(c<=65535){if(r+2>=u)break;t[r++]=224|c>>12,t[r++]=128|c>>6&63,t[r++]=128|c&63}else{if(r+3>=u)break;c>1114111&&L("Invalid Unicode code point "+j(c)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|c>>18,t[r++]=128|c>>12&63,t[r++]=128|c>>6&63,t[r++]=128|c&63}}return t[r]=0,r-s},Te=(e,t,r)=>(o(typeof r=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),kt(e,N,t,r)),Ee=e=>Ut(e),Ct=e=>{var t=Se(e)+1,r=Ee(t);return Te(e,r,t),r},Fe=(e,t,r,i,s)=>{var u={string:w=>{var z=0;return w!=null&&w!==0&&(z=Ct(w)),z},array:w=>{var z=Ee(w.length);return At(w,z),z}};function l(w){return t==="string"?A(w):t==="boolean"?!!w:w}var c=Ft(e),d=[],R=0;if(o(t!=="array",'Return type should not be "array".'),i)for(var O=0;O<i.length;O++){var Me=u[r[O]];Me?(R===0&&(R=$()),d[O]=Me(i[O])):d[O]=i[O]}var le=a.currData,Q=c(...d);function Pe(w){return Et(),R!==0&&H(R),l(w)}var De=s==null?void 0:s.async;return Tt(),a.currData!=le?(o(!(le&&a.currData),"We cannot start an async operation when one is already flight"),o(!(le&&!a.currData),"We cannot stop an async operation in flight"),o(De,"The call to "+e+" is running asynchronously. If this was intended, add the async option to the ccall/cwrap call."),a.whenDone().then(Pe)):(Q=Pe(Q),De?Promise.resolve(Q):Q)},It=(e,t,r,i)=>(...s)=>Fe(e,t,r,s,i),Rt=e=>{var t=Se(e)+1,r=ke(t);return r&&Te(e,r,t),r};function Mt(){je("fetchSettings")}var Ae={55292:()=>performance.now(),55322:e=>performance.now()-e,55357:(e,t)=>globalThis.ulisp.call(A(e),t),55413:(e,t,r)=>{globalThis.ulisp.call(A(e),t,r)},55466:(e,t)=>globalThis.ulisp.call(A(e),t),55522:(e,t,r)=>{globalThis.ulisp.call(A(e),t,r)},55575:(e,t,r)=>{globalThis.ulisp.call(A(e),t,r)}};function Pt(e){return a.handleAsync(async()=>{await globalThis.ulisp.delay(e)})}function Dt(){return a.handleAsync(async()=>await globalThis.ulisp.wait_for_tick())}var oe={__assert_fail:st,__asyncjs__delay_on_host:Pt,__asyncjs__wait_for_tick_on_host:Dt,_abort_js:lt,_emscripten_throw_longjmp:ct,emscripten_asm_const_double:dt,emscripten_asm_const_int:ft,emscripten_resize_heap:pt,fd_close:yt,fd_seek:vt,fd_write:ht,invoke_ii:Vt,invoke_iii:Jt,invoke_vi:Kt,invoke_vii:Yt},v=await nt();n._print_version=m("print_version",0),n._setup=m("setup",0),n._stop_loop=m("stop_loop",0),n._evaluate=m("evaluate",1);var ke=m("malloc",1),xt=n._free=m("free",1),q=m("setThrew",2),Lt=v.emscripten_stack_init;v.emscripten_stack_get_free,v.emscripten_stack_get_base;var Ce=v.emscripten_stack_get_end,Ot=v._emscripten_stack_restore,Ut=v._emscripten_stack_alloc,Ie=v.emscripten_stack_get_current,Nt=n.dynCall_vi=m("dynCall_vi",2);n.dynCall_i=m("dynCall_i",1);var Wt=n.dynCall_vii=m("dynCall_vii",3),Bt=n.dynCall_ii=m("dynCall_ii",2),Gt=n.dynCall_iii=m("dynCall_iii",3);n.dynCall_iiii=m("dynCall_iiii",4),n.dynCall_jiji=m("dynCall_jiji",4);var jt=m("asyncify_start_unwind",1),Ht=m("asyncify_stop_unwind",0),$t=m("asyncify_start_rewind",1),zt=m("asyncify_stop_rewind",0);function Yt(e,t,r){var i=$();try{Wt(e,t,r)}catch(s){if(H(i),s!==s+0)throw s;q(1,0)}}function Vt(e,t){var r=$();try{return Bt(e,t)}catch(i){if(H(r),i!==i+0)throw i;q(1,0)}}function Jt(e,t,r){var i=$();try{return Gt(e,t,r)}catch(s){if(H(i),s!==s+0)throw s;q(1,0)}}function Kt(e,t){var r=$();try{Nt(e,t)}catch(i){if(H(r),i!==i+0)throw i;q(1,0)}}n.ccall=Fe,n.cwrap=It,n.UTF8ToString=A,n.stringToNewUTF8=Rt;var Xt=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getTempRet0","setTempRet0","zeroMemory","growMemory","strError","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","runMainThreadEmAsm","jstoi_q","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","asmjsMangle","asyncLoad","mmapAlloc","HandleAllocator","getNativeTypeSize","addOnInit","addOnPostCtor","addOnPreMain","addOnExit","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","uleb128Encode","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","getEnvStrings","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","initRandomFill","randomFill","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","ExceptionInfo","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar","FS_unlink","FS_createDataFile","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Xt.forEach($e);var Zt=["run","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","INT53_MAX","INT53_MIN","bigintToI53Checked","stackSave","stackRestore","stackAlloc","ptrToString","exitJS","getHeapMax","abortOnCannotGrowMemory","ENV","ERRNO_CODES","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","readEmAsmArgs","runEmAsmFunction","jstoi_s","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","alignMemory","wasmTable","noExitRuntime","addOnPreRun","addOnPostRun","getCFunc","sigToWasmTypes","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","UTF16Decoder","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","flush_NO_FILESYSTEM","emSetImmediate","emClearImmediate_deps","emClearImmediate","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_stdin_getChar_buffer","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","runAndAbortIfError","Asyncify","Fibers","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Zt.forEach(pe);var Re;function qt(){Lt(),Ge()}function se(){if(D>0){W=se;return}if(qt(),Ye(),D>0){W=se;return}function e(){var t;o(!Re),Re=!0,n.calledRun=!0,!M&&(Ve(),E(n),(t=n.onRuntimeInitialized)==null||t.call(n),K("onRuntimeInitialized"),o(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Je())}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e(),J()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();K("preInit"),se(),f=F;for(const e of Object.keys(n))e in S||Object.defineProperty(S,e,{configurable:!0,get(){y(`Access to module property ('${e}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return f}})();(()=>{var _=k;k=function(p){if(new.target)throw new Error("createLispWasmModule() should not be called with `new createLispWasmModule()`");return _(p)}})();var C=k;class U{constructor(){ce(this,"buffer","")}start(){this.buffer=""}push(p){this.buffer+=p}end(){let p=this.buffer.trimEnd();return this.buffer="",p}}async function xe({createLispWasmModule:_}){const p=new U;function S(...E){p.push(E.reduce((b,F)=>(b+=F,b),""))}const f=await _({print:S,printErr:S});f._setup();async function n(E){p.start();const b=f.stringToNewUTF8(`(progn ${E})`);await f.ccall("evaluate","void",["number"],[b],{async:!0}),f._free(b);const F=p.end();if(F==="nil")return null;if(F==="t")return!0;try{return JSON.parse(F)}catch{return F}}return{eval:n}}async function Le(_={}){const{wasmPath:p="",tick:S}=_;return globalThis.ulisp={call(f,...n){switch(console.log("ulisp called",f,...n),f){case"analogRead":return 0;case"analogWrite":break;case"digitalRead":return 0}},async delay(f=0){return new Promise((n,E)=>{console.log("delay",f),setTimeout(n,parseInt(f,10))})},escape(){return 0},wait_for_tick(){if(S)return S()},stop(){}},await xe({createLispWasmModule(f={}){return C({...f,locateFile(n,E){return p+n}})}})}let ee;async function Oe(_){const{id:p,data:S,action:f}=_.data;if(f){console.log("Action",f);return}const{code:n,wasmPath:E=""}=S;let b=0;ee||(ee=await Le({wasmPath:E,tick(){b++,self.postMessage({step:b})}}));const F=await ee.eval(n);self.postMessage({id:p,result:F})}self.addEventListener("message",function(_){Oe(_)})})();
