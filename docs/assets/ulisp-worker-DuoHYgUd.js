var Qt=Object.defineProperty;var er=(C,I,N)=>I in C?Qt(C,I,{enumerable:!0,configurable:!0,writable:!0,value:N}):C[I]=N;var ue=(C,I,N)=>er(C,typeof I!="symbol"?I+"":I,N);(function(){"use strict";var C=(()=>{var y;var g=typeof document<"u"?(y=document.currentScript)==null?void 0:y.src:void 0;return async function(w={}){var F,n=w,b,S,A=new Promise((e,t)=>{b=e,S=t}),T={...n},V=(e,t)=>{throw t},R="";function Ne(e){return n.locateFile?n.locateFile(e,R):R+e}var de;{if(typeof document<"u"&&document.currentScript&&(R=document.currentScript.src),g&&(R=g),R.startsWith("blob:")?R="":R=R.slice(0,R.replace(/[?#].*/,"").lastIndexOf("/")+1),!(typeof window=="object"||typeof WorkerGlobalScope<"u"))throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");de=async e=>{o(!pe(e),"readAsync does not work with file:// URLs");var t=await fetch(e,{credentials:"same-origin"});if(t.ok)return t.arrayBuffer();throw new Error(t.status+" : "+t.url)}}var We=n.print||console.log.bind(console),v=n.printErr||console.error.bind(console);Object.assign(n,T),T=null,Mt(),n.arguments&&n.arguments,D("arguments","arguments_"),n.thisProgram&&n.thisProgram,D("thisProgram","thisProgram"),o(typeof n.memoryInitializerPrefixURL>"u","Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.pthreadMainPrefixURL>"u","Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.cdInitializerPrefixURL>"u","Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),o(typeof n.filePackagePrefixURL>"u","Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),o(typeof n.read>"u","Module.read option was removed"),o(typeof n.readAsync>"u","Module.readAsync option was removed (modify readAsync in JS)"),o(typeof n.readBinary>"u","Module.readBinary option was removed (modify readBinary in JS)"),o(typeof n.setWindowTitle>"u","Module.setWindowTitle option was removed (modify emscripten_set_window_title in JS)"),o(typeof n.TOTAL_MEMORY>"u","Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),D("asm","wasmExports"),D("readAsync","readAsync"),D("readBinary","readBinary"),D("setWindowTitle","setWindowTitle"),o(!0,"worker environment detected but not enabled at build time.  Add `worker` to `-sENVIRONMENT` to enable."),o(!0,"node environment detected but not enabled at build time.  Add `node` to `-sENVIRONMENT` to enable."),o(!0,"shell environment detected but not enabled at build time.  Add `shell` to `-sENVIRONMENT` to enable.");var J=n.wasmBinary;D("wasmBinary","wasmBinary"),typeof WebAssembly!="object"&&v("no native wasm support detected");var ne,P=!1,Be;function o(e,t){e||m("Assertion failed"+(t?": "+t:""))}var ae,W,K,_,fe,me,ie=!1,pe=e=>e.startsWith("file://");function Ge(){var e=Ie();o((e&3)==0),e==0&&(e+=4),_[e>>2]=34821223,_[e+4>>2]=2310721022,_[0]=1668509029}function X(){if(!P){var e=Ie();e==0&&(e+=4);var t=_[e>>2],r=_[e+4>>2];(t!=34821223||r!=2310721022)&&m(`Stack overflow! Stack cookie has been overwritten at ${H(e)}, expected hex dwords 0x89BACDFE and 0x2135467, but received ${H(r)} ${H(t)}`),_[0]!=1668509029&&m("Runtime error: The application has corrupted its heap memory area (address zero)!")}}if((()=>{var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,t[0]!==115||t[1]!==99)throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"})(),n.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");function D(e,t,r=!0){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){let i=r?" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)":"";m(`\`Module.${e}\` has been replaced by \`${t}\``+i)}})}function Z(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,set(){m(`Attempt to set \`Module.${e}\` after it has already been processed.  This can happen, for example, when code is injected via '--post-js' rather than '--pre-js'`)}})}function je(e){Object.getOwnPropertyDescriptor(n,e)&&m(`\`Module.${e}\` was supplied but \`${e}\` not included in INCOMING_MODULE_JS_API`)}function He(e){return e==="FS_createPath"||e==="FS_createDataFile"||e==="FS_createPreloadedFile"||e==="FS_unlink"||e==="addRunDependency"||e==="FS_createLazyFile"||e==="FS_createDevice"||e==="removeRunDependency"}function $e(e){ye(e)}function ye(e){Object.getOwnPropertyDescriptor(n,e)||Object.defineProperty(n,e,{configurable:!0,get(){var t=`'${e}' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the Emscripten FAQ)`;He(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),m(t)}})}function ze(){var e=ne.buffer;n.HEAP8=ae=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=W=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=K=new Int32Array(e),n.HEAPU32=_=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=me=new Float64Array(e),n.HEAP64=fe=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e)}o(!n.STACK_SIZE,"STACK_SIZE can no longer be set at runtime.  Use -sSTACK_SIZE at link time"),o(typeof Int32Array<"u"&&typeof Float64Array<"u"&&Int32Array.prototype.subarray!=null&&Int32Array.prototype.set!=null,"JS engine does not provide full typed array support"),o(!n.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),o(!n.INITIAL_MEMORY,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically");function Ye(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)ot(n.preRun.shift());Z("preRun"),ve(_e)}function Ve(){o(!ie),ie=!0,X(),p.__wasm_call_ctors()}function Je(){if(X(),n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)it(n.postRun.shift());Z("postRun"),ve(ge)}var x=0,B=null,G={},L=null;function Ke(e){var t;x++,(t=n.monitorRunDependencies)==null||t.call(n,x),o(!G[e]),G[e]=1,L===null&&typeof setInterval<"u"&&(L=setInterval(()=>{if(P){clearInterval(L),L=null;return}var r=!1;for(var i in G)r||(r=!0,v("still waiting on run dependencies:")),v(`dependency: ${i}`);r&&v("(end of list)")},1e4))}function Xe(e){var r;if(x--,(r=n.monitorRunDependencies)==null||r.call(n,x),o(G[e]),delete G[e],x==0&&(L!==null&&(clearInterval(L),L=null),B)){var t=B;B=null,t()}}function m(e){var r;(r=n.onAbort)==null||r.call(n,e),e="Aborted("+e+")",v(e),P=!0,e.indexOf("RuntimeError: unreachable")>=0&&(e+='. "unreachable" may be due to ASYNCIFY_STACK_SIZE not being large enough (try increasing it)');var t=new WebAssembly.RuntimeError(e);throw S(t),t}var E={error(){m("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init(){E.error()},createDataFile(){E.error()},createPreloadedFile(){E.error()},createLazyFile(){E.error()},open(){E.error()},mkdev(){E.error()},registerDevice(){E.error()},analyzePath(){E.error()},ErrnoError(){E.error()}};n.FS_createDataFile=E.createDataFile,n.FS_createPreloadedFile=E.createPreloadedFile;function f(e,t){return(...r)=>{o(ie,`native function \`${e}\` called before runtime initialization`);var i=p[e];return o(i,`exported native function \`${e}\` not found`),o(r.length<=t,`native function \`${e}\` called with ${r.length} args but expects ${t}`),i(...r)}}var j;function Ze(){return Ne("ulisp.wasm")}function qe(e){if(e==j&&J)return new Uint8Array(J);throw"both async and sync fetching of the wasm failed"}async function Qe(e){if(!J)try{var t=await de(e);return new Uint8Array(t)}catch{}return qe(e)}async function et(e,t){try{var r=await Qe(e),i=await WebAssembly.instantiate(r,t);return i}catch(s){v(`failed to asynchronously prepare wasm: ${s}`),pe(j)&&v(`warning: Loading from a file URI (${j}) is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing`),m(s)}}async function tt(e,t,r){if(!e&&typeof WebAssembly.instantiateStreaming=="function")try{var i=fetch(t,{credentials:"same-origin"}),s=await WebAssembly.instantiateStreaming(i,r);return s}catch(u){v(`wasm streaming compile failed: ${u}`),v("falling back to ArrayBuffer instantiation")}return et(t,r)}function rt(){return a.instrumentWasmImports(se),{env:se,wasi_snapshot_preview1:se}}async function nt(){function e(l,c){return p=l.exports,p=a.instrumentWasmExports(p),ne=p.memory,o(ne,"memory not found in wasm exports"),ze(),Se=p.__indirect_function_table,o(Se,"table not found in wasm exports"),Xe("wasm-instantiate"),p}Ke("wasm-instantiate");var t=n;function r(l){return o(n===t,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),t=null,e(l.instance)}var i=rt();if(n.instantiateWasm)return new Promise((l,c)=>{try{n.instantiateWasm(i,(d,M)=>{e(d,M),l(d.exports)})}catch(d){v(`Module.instantiateWasm callback failed with error: ${d}`),c(d)}});j??(j=Ze());try{var s=await tt(J,j,i),u=r(s);return u}catch(l){return S(l),Promise.reject(l)}}class at{constructor(t){ue(this,"name","ExitStatus");this.message=`Program terminated with exit(${t})`,this.status=t}}var ve=e=>{for(;e.length>0;)e.shift()(n)},ge=[],it=e=>ge.unshift(e),_e=[],ot=e=>_e.unshift(e);n.noExitRuntime;var H=e=>(o(typeof e=="number"),e>>>=0,"0x"+e.toString(16).padStart(8,"0")),$=e=>Ot(e),z=()=>Re(),O=e=>{O.shown||(O.shown={}),O.shown[e]||(O.shown[e]=1,v(e))},he=typeof TextDecoder<"u"?new TextDecoder:void 0,we=(e,t=0,r=NaN)=>{for(var i=t+r,s=t;e[s]&&!(s>=i);)++s;if(s-t>16&&e.buffer&&he)return he.decode(e.subarray(t,s));for(var u="";t<s;){var l=e[t++];if(!(l&128)){u+=String.fromCharCode(l);continue}var c=e[t++]&63;if((l&224)==192){u+=String.fromCharCode((l&31)<<6|c);continue}var d=e[t++]&63;if((l&240)==224?l=(l&15)<<12|c<<6|d:((l&248)!=240&&O("Invalid UTF-8 leading byte "+H(l)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),l=(l&7)<<18|c<<12|d<<6|e[t++]&63),l<65536)u+=String.fromCharCode(l);else{var M=l-65536;u+=String.fromCharCode(55296|M>>10,56320|M&1023)}}return u},k=(e,t)=>(o(typeof e=="number",`UTF8ToString expects a number (got ${typeof e})`),e?we(W,e,t):""),st=(e,t,r,i)=>m(`Assertion failed: ${k(e)}, at: `+[t?k(t):"unknown filename",r,i?k(i):"unknown function"]),lt=()=>m("native code called abort()"),ct=()=>{throw 1/0},q=[],ut=(e,t)=>{o(Array.isArray(q)),o(t%16==0),q.length=0;for(var r;r=W[e++];){var i=String.fromCharCode(r),s=["d","f","i","p"];s.push("j"),o(s.includes(i),`Invalid character ${r}("${i}") in readEmAsmArgs! Use only [${s}], and do not specify "v" for void return argument.`);var u=r!=105;u&=r!=112,t+=u&&t%8?4:0,q.push(r==112?_[t>>2]:r==106?fe[t>>3]:r==105?K[t>>2]:me[t>>3]),t+=u?8:4}return q},be=(e,t,r)=>{var i=ut(t,r);return o(ke.hasOwnProperty(e),`No EM_ASM constant found at address ${e}.  The loaded WebAssembly file is likely out of sync with the generated JavaScript.`),ke[e](...i)},dt=(e,t,r)=>be(e,t,r),ft=(e,t,r)=>be(e,t,r),mt=e=>{m(`Cannot enlarge memory arrays to size ${e} bytes (OOM). Either (1) compile with -sINITIAL_MEMORY=X with X higher than the current value ${ae.length}, (2) compile with -sALLOW_MEMORY_GROWTH which allows increasing the size at runtime, or (3) if you want malloc to return NULL (0) instead of this abort, compile with -sABORTING_MALLOC=0`)},pt=e=>{W.length,e>>>=0,mt(e)},yt=e=>{m("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")};function vt(e,t,r,i){return 70}var gt=[null,[],[]],_t=(e,t)=>{var r=gt[e];o(r),t===0||t===10?((e===1?We:v)(we(r)),r.length=0):r.push(t)},ht=(e,t,r,i)=>{for(var s=0,u=0;u<r;u++){var l=_[t>>2],c=_[t+4>>2];t+=8;for(var d=0;d<c;d++)_t(e,W[l+d]);s+=c}return _[i>>2]=s,0},Se,Q=e=>{try{return e()}catch(t){m(t)}},wt=e=>{if(e instanceof at||e=="unwind")return Be;X(),e instanceof WebAssembly.RuntimeError&&Re()<=0&&v("Stack overflow detected.  You can try increasing -sSTACK_SIZE (currently set to 65536)"),V(1,e)},oe=0,bt=()=>{},St=e=>{if(P){v("user callback triggered after runtime exited or application aborted.  Ignoring.");return}try{e(),bt()}catch(t){wt(t)}},Tt=()=>{oe+=1},Et=()=>{o(oe>0),oe-=1},a={instrumentWasmImports(e){var t=/^(invoke_.*|__asyncjs__.*)$/;for(let[r,i]of Object.entries(e))if(typeof i=="function"){let s=i.isAsync||t.test(r);e[r]=(...u)=>{var l=a.state;try{return i(...u)}finally{var c=l===a.State.Normal&&a.state===a.State.Disabled,d=r.startsWith("invoke_")&&!0;if(a.state!==l&&!s&&!c&&!d)throw new Error(`import ${r} was not in ASYNCIFY_IMPORTS, but changed the state`)}}}},instrumentWasmExports(e){var t={};for(let[r,i]of Object.entries(e))typeof i=="function"?t[r]=(...s)=>{a.exportCallStack.push(r);try{return i(...s)}finally{if(!P){var u=a.exportCallStack.pop();o(u===r),a.maybeStopUnwind()}}}:t[r]=i;return t},State:{Normal:0,Unwinding:1,Rewinding:2,Disabled:3},state:0,StackSize:4096,currData:null,handleSleepReturnValue:0,exportCallStack:[],callStackNameToId:{},callStackIdToName:{},callStackId:0,asyncPromiseHandlers:null,sleepCallbacks:[],getCallStackId(e){var t=a.callStackNameToId[e];return t===void 0&&(t=a.callStackId++,a.callStackNameToId[e]=t,a.callStackIdToName[t]=e),t},maybeStopUnwind(){a.currData&&a.state===a.State.Unwinding&&a.exportCallStack.length===0&&(a.state=a.State.Normal,Q(Ht),typeof Fibers<"u"&&Fibers.trampoline())},whenDone(){return o(a.currData,"Tried to wait for an async operation when none is in progress."),o(!a.asyncPromiseHandlers,"Cannot have multiple async operations in flight at once"),new Promise((e,t)=>{a.asyncPromiseHandlers={resolve:e,reject:t}})},allocateData(){var e=Ce(12+a.StackSize);return a.setDataHeader(e,e+12,a.StackSize),a.setDataRewindFunc(e),e},setDataHeader(e,t,r){_[e>>2]=t,_[e+4>>2]=t+r},setDataRewindFunc(e){var t=a.exportCallStack[0],r=a.getCallStackId(t);K[e+8>>2]=r},getDataRewindFuncName(e){var t=K[e+8>>2],r=a.callStackIdToName[t];return r},getDataRewindFunc(e){var t=p[e];return t},doRewind(e){var t=a.getDataRewindFuncName(e),r=a.getDataRewindFunc(t);return r()},handleSleep(e){if(o(a.state!==a.State.Disabled,"Asyncify cannot be done during or after the runtime exits"),!P){if(a.state===a.State.Normal){var t=!1,r=!1;e((i=0)=>{if(o(!i||typeof i=="number"||typeof i=="boolean"),!P&&(a.handleSleepReturnValue=i,t=!0,!!r)){o(!a.exportCallStack.length,"Waking up (starting to rewind) must be done from JS, without compiled code on the stack."),a.state=a.State.Rewinding,Q(()=>$t(a.currData)),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.resume();var s,u=!1;try{s=a.doRewind(a.currData)}catch(d){s=d,u=!0}var l=!1;if(!a.currData){var c=a.asyncPromiseHandlers;c&&(a.asyncPromiseHandlers=null,(u?c.reject:c.resolve)(s),l=!0)}if(u&&!l)throw s}}),r=!0,t||(a.state=a.State.Unwinding,a.currData=a.allocateData(),typeof MainLoop<"u"&&MainLoop.func&&MainLoop.pause(),Q(()=>jt(a.currData)))}else a.state===a.State.Rewinding?(a.state=a.State.Normal,Q(zt),xt(a.currData),a.currData=null,a.sleepCallbacks.forEach(St)):m(`invalid state: ${a.state}`);return a.handleSleepReturnValue}},handleAsync(e){return a.handleSleep(t=>{e().then(t).catch(()=>{})})}},Ft=e=>{var t=n["_"+e];return o(t,"Cannot call unknown function "+e+", make sure it is exported"),t},At=(e,t)=>{o(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),ae.set(e,t)},Te=e=>{for(var t=0,r=0;r<e.length;++r){var i=e.charCodeAt(r);i<=127?t++:i<=2047?t+=2:i>=55296&&i<=57343?(t+=4,++r):t+=3}return t},kt=(e,t,r,i)=>{if(o(typeof e=="string",`stringToUTF8Array expects a string (got ${typeof e})`),!(i>0))return 0;for(var s=r,u=r+i-1,l=0;l<e.length;++l){var c=e.charCodeAt(l);if(c>=55296&&c<=57343){var d=e.charCodeAt(++l);c=65536+((c&1023)<<10)|d&1023}if(c<=127){if(r>=u)break;t[r++]=c}else if(c<=2047){if(r+1>=u)break;t[r++]=192|c>>6,t[r++]=128|c&63}else if(c<=65535){if(r+2>=u)break;t[r++]=224|c>>12,t[r++]=128|c>>6&63,t[r++]=128|c&63}else{if(r+3>=u)break;c>1114111&&O("Invalid Unicode code point "+H(c)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|c>>18,t[r++]=128|c>>12&63,t[r++]=128|c>>6&63,t[r++]=128|c&63}}return t[r]=0,r-s},Ee=(e,t,r)=>(o(typeof r=="number","stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),kt(e,W,t,r)),Fe=e=>Ut(e),Ct=e=>{var t=Te(e)+1,r=Fe(t);return Ee(e,r,t),r},Ae=(e,t,r,i,s)=>{var u={string:h=>{var Y=0;return h!=null&&h!==0&&(Y=Ct(h)),Y},array:h=>{var Y=Fe(h.length);return At(h,Y),Y}};function l(h){return t==="string"?k(h):t==="boolean"?!!h:h}var c=Ft(e),d=[],M=0;if(o(t!=="array",'Return type should not be "array".'),i)for(var U=0;U<i.length;U++){var Pe=u[r[U]];Pe?(M===0&&(M=z()),d[U]=Pe(i[U])):d[U]=i[U]}var ce=a.currData,te=c(...d);function De(h){return Et(),M!==0&&$(M),l(h)}var xe=s==null?void 0:s.async;return Tt(),a.currData!=ce?(o(!(ce&&a.currData),"We cannot start an async operation when one is already flight"),o(!(ce&&!a.currData),"We cannot stop an async operation in flight"),o(xe,"The call to "+e+" is running asynchronously. If this was intended, add the async option to the ccall/cwrap call."),a.whenDone().then(De)):(te=De(te),xe?Promise.resolve(te):te)},It=(e,t,r,i)=>(...s)=>Ae(e,t,r,s,i),Rt=e=>{var t=Te(e)+1,r=Ce(t);return r&&Ee(e,r,t),r};function Mt(){je("fetchSettings")}var ke={55356:()=>performance.now(),55386:e=>performance.now()-e,55421:(e,t)=>globalThis.ulisp.call(k(e),t),55477:(e,t,r)=>{globalThis.ulisp.call(k(e),t,r)},55530:(e,t)=>globalThis.ulisp.call(k(e),t),55586:(e,t,r)=>{globalThis.ulisp.call(k(e),t,r)},55639:(e,t,r)=>{globalThis.ulisp.call(k(e),t,r)}};function Pt(e){return a.handleAsync(async()=>{await globalThis.ulisp.delay(e)})}function Dt(){return globalThis.ulisp.wait_for_tick()}var se={__assert_fail:st,__asyncjs__delay_on_host:Pt,_abort_js:lt,_emscripten_throw_longjmp:ct,emscripten_asm_const_double:dt,emscripten_asm_const_int:ft,emscripten_resize_heap:pt,fd_close:yt,fd_seek:vt,fd_write:ht,invoke_ii:Vt,invoke_iii:Jt,invoke_vi:Kt,invoke_vii:Yt,wait_for_tick_on_host:Dt},p=await nt();n._print_version=f("print_version",0),n._setup=f("setup",0),n._stop_loop=f("stop_loop",0),n._evaluate=f("evaluate",1);var Ce=f("malloc",1),xt=n._free=f("free",1),ee=f("setThrew",2),Lt=p.emscripten_stack_init;p.emscripten_stack_get_free,p.emscripten_stack_get_base;var Ie=p.emscripten_stack_get_end,Ot=p._emscripten_stack_restore,Ut=p._emscripten_stack_alloc,Re=p.emscripten_stack_get_current,Nt=n.dynCall_vi=f("dynCall_vi",2);n.dynCall_i=f("dynCall_i",1);var Wt=n.dynCall_vii=f("dynCall_vii",3),Bt=n.dynCall_ii=f("dynCall_ii",2),Gt=n.dynCall_iii=f("dynCall_iii",3);n.dynCall_iiii=f("dynCall_iiii",4),n.dynCall_jiji=f("dynCall_jiji",4);var jt=f("asyncify_start_unwind",1),Ht=f("asyncify_stop_unwind",0),$t=f("asyncify_start_rewind",1),zt=f("asyncify_stop_rewind",0);function Yt(e,t,r){var i=z();try{Wt(e,t,r)}catch(s){if($(i),s!==s+0)throw s;ee(1,0)}}function Vt(e,t){var r=z();try{return Bt(e,t)}catch(i){if($(r),i!==i+0)throw i;ee(1,0)}}function Jt(e,t,r){var i=z();try{return Gt(e,t,r)}catch(s){if($(i),s!==s+0)throw s;ee(1,0)}}function Kt(e,t){var r=z();try{Nt(e,t)}catch(i){if($(r),i!==i+0)throw i;ee(1,0)}}n.ccall=Ae,n.cwrap=It,n.UTF8ToString=k,n.stringToNewUTF8=Rt;var Xt=["writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getTempRet0","setTempRet0","zeroMemory","growMemory","strError","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","emscriptenLog","runMainThreadEmAsm","jstoi_q","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","asmjsMangle","asyncLoad","mmapAlloc","HandleAllocator","getNativeTypeSize","addOnInit","addOnPostCtor","addOnPreMain","addOnExit","STACK_SIZE","STACK_ALIGN","POINTER_SIZE","ASSERTIONS","uleb128Encode","generateFuncType","convertJsFunctionToWasm","getEmptyTableSlot","updateTableMap","getFunctionAddress","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","jsStackTrace","getCallstack","convertPCtoSourceLocation","getEnvStrings","checkWasiClock","wasiRightsToMuslOFlags","wasiOFlagsToMuslOFlags","initRandomFill","randomFill","safeSetTimeout","setImmediateWrapped","safeRequestAnimationFrame","clearImmediateWrapped","registerPostMainLoop","registerPreMainLoop","getPromise","makePromise","idsToPromises","makePromiseCallback","ExceptionInfo","findMatchingCatch","Browser_asyncPrepareDataCounter","isLeapYear","ydayFromDate","arraySum","addDays","getSocketFromFD","getSocketAddress","FS_createPreloadedFile","FS_modeStringToFlags","FS_getMode","FS_stdin_getChar","FS_unlink","FS_createDataFile","FS_mkdirTree","_setNetworkCallback","heapObjectForWebGLType","toTypedArrayIndex","webgl_enable_ANGLE_instanced_arrays","webgl_enable_OES_vertex_array_object","webgl_enable_WEBGL_draw_buffers","webgl_enable_WEBGL_multi_draw","webgl_enable_EXT_polygon_offset_clamp","webgl_enable_EXT_clip_control","webgl_enable_WEBGL_polygon_mode","emscriptenWebGLGet","computeUnpackAlignedImageSize","colorChannelsInGlTextureFormat","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","__glGetActiveAttribOrUniform","writeGLArray","registerWebGlEventCallback","ALLOC_NORMAL","ALLOC_STACK","allocate","writeStringToMemory","writeAsciiToMemory","setErrNo","demangle","stackTrace"];Xt.forEach($e);var Zt=["run","addRunDependency","removeRunDependency","out","err","callMain","abort","wasmMemory","wasmExports","writeStackCookie","checkStackCookie","INT53_MAX","INT53_MIN","bigintToI53Checked","stackSave","stackRestore","stackAlloc","ptrToString","exitJS","getHeapMax","abortOnCannotGrowMemory","ENV","ERRNO_CODES","DNS","Protocols","Sockets","timers","warnOnce","readEmAsmArgsArray","readEmAsmArgs","runEmAsmFunction","jstoi_s","handleException","keepRuntimeAlive","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","alignMemory","wasmTable","noExitRuntime","addOnPreRun","addOnPostRun","getCFunc","sigToWasmTypes","freeTableIndexes","functionsInTableMap","setValue","getValue","PATH","PATH_FS","UTF8Decoder","UTF8ArrayToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","UTF16Decoder","stringToUTF8OnStack","writeArrayToMemory","JSEvents","specialHTMLTargets","findCanvasEventTarget","currentFullscreenStrategy","restoreOldWindowedStyle","UNWIND_CACHE","ExitStatus","flush_NO_FILESYSTEM","emSetImmediate","emClearImmediate_deps","emClearImmediate","promiseMap","uncaughtExceptionCount","exceptionLast","exceptionCaught","Browser","getPreloadedImageData__data","wget","MONTH_DAYS_REGULAR","MONTH_DAYS_LEAP","MONTH_DAYS_REGULAR_CUMULATIVE","MONTH_DAYS_LEAP_CUMULATIVE","SYSCALLS","preloadPlugins","FS_stdin_getChar_buffer","FS_createPath","FS_createDevice","FS_readFile","FS","FS_createLazyFile","MEMFS","TTY","PIPEFS","SOCKFS","tempFixedLengthArray","miniTempWebGLFloatBuffers","miniTempWebGLIntBuffers","GL","AL","GLUT","EGL","GLEW","IDBStore","runAndAbortIfError","Asyncify","Fibers","SDL","SDL_gfx","allocateUTF8","allocateUTF8OnStack","print","printErr"];Zt.forEach(ye);var Me;function qt(){Lt(),Ge()}function le(){if(x>0){B=le;return}if(qt(),Ye(),x>0){B=le;return}function e(){var t;o(!Me),Me=!0,n.calledRun=!0,!P&&(Ve(),b(n),(t=n.onRuntimeInitialized)==null||t.call(n),Z("onRuntimeInitialized"),o(!n._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),Je())}n.setStatus?(n.setStatus("Running..."),setTimeout(()=>{setTimeout(()=>n.setStatus(""),1),e()},1)):e(),X()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();Z("preInit"),le(),F=A;for(const e of Object.keys(n))e in w||Object.defineProperty(w,e,{configurable:!0,get(){m(`Access to module property ('${e}') is no longer possible via the module constructor argument; Instead, use the result of the module constructor.`)}});return F}})();(()=>{var g=C;C=function(y){if(new.target)throw new Error("createLispWasmModule() should not be called with `new createLispWasmModule()`");return g(y)}})();var I=C;class N{constructor(){ue(this,"buffer","")}start(){this.buffer=""}push(y){this.buffer+=y}end(){let y=this.buffer.trimEnd();return this.buffer="",y}}async function Le({createLispWasmModule:g,print:y}){const w=new N;function F(...S){if(y)return y(...S);w.push(S.reduce((A,T)=>(A+=T,A),""))}const n=await g({print:F,printErr:F});n._setup();async function b(S){w.start();const A=n.stringToNewUTF8(`(progn ${S})`);await n.ccall("evaluate","void",["number"],[A],{async:!0}),n._free(A);const T=w.end();if(T==="nil")return null;if(T==="t")return!0;try{return JSON.parse(T)}catch{return T}}return{eval:b}}async function Oe(g={}){const{wasmPath:y="",tick:w,print:F}=g;return globalThis.ulisp={call(n,...b){switch(console.log("ulisp called",n,...b),n){case"analogRead":return 0;case"analogWrite":break;case"digitalRead":return 0}},async delay(n=0){return new Promise((b,S)=>{console.log("delay",n),setTimeout(b,parseInt(n,10))})},escape(){return 0},wait_for_tick(){if(w)return w()},stop(){}},await Le({print:F,createLispWasmModule(n={}){return I({...n,locateFile(b,S){return y+b}})}})}let re;async function Ue(g){const{id:y,data:w,action:F,print:n}=g.data;if(F){console.log("Action",F);return}const{code:b,wasmPath:S=""}=w;let A=0;re||(re=await Oe({wasmPath:S,tick(){A++,self.postMessage({step:A})},print(V){self.postMessage({print:V})}}));const T=await re.eval(b);self.postMessage({id:y,result:T})}self.addEventListener("message",function(g){Ue(g)})})();
