var v=Object.defineProperty;var r=(u,a)=>v(u,"name",{value:a,configurable:!0});(function(){"use strict";(function(){const s={NODE_ENV:"production"};try{if(process){process.env=Object.assign({},process.env),Object.assign(process.env,s);return}}catch{}globalThis.process={env:s}})();var u=Object.defineProperty,a=r((s,o)=>u(s,"name",{value:o,configurable:!0}),"d");const c=document.getElementById("console"),g=document.getElementById("canvas");console.log("createUlispModule",createUlispModule),(async()=>{const s=await createUlispModule({print:function(){if(c)return c.value="",(...t)=>{const e=t.join(" ").split(`
`);for(const n of e)if(n.startsWith("json:")){console.log(n);try{const p=JSON.parse(n.replace(/^json:/,""));console.log("Got value",p)}catch(p){console.log(p)}}else n&&(console.log(n),c.innerText+=n+`
`,c.scrollTop=c.scrollHeight)}}(),canvas:(()=>{if(g)return g})(),setStatus:function(t){if(console.log("this",this),this.setStatus.last||(this.setStatus.last={time:Date.now(),text:""}),t===this.setStatus.last.text)return;const e=t.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),n=Date.now();e&&n-this.setStatus.last.time<30||(this.setStatus.last.time=n,this.setStatus.last.text=t,e&&(t=e[1]),t&&console.log("uLisp",t))},totalDependencies:0});window.onerror=t=>{s.setStatus("Exception thrown, see JavaScript console"),s.setStatus=e=>{e&&console.error("[post-exception status] "+e)}};const o=[];let l=!1;s._setup(),window.ulisp={run:i,call(t,...e){switch(console.log("ulisp.call",t,...e),t){case"analogRead":return e[0]/2;case"analogWrite":break;case"digitalRead":return e[0]}},escape(){return 0},wait_for_tick(){return l?1:new Promise((t,e)=>{o.push(t)})},stop(){l=!0}};const m=document.getElementById("code-form"),d=document.getElementById("code"),f=document.getElementById("run");m.addEventListener("submit",function(t){t.preventDefault(),i(d.value)}),f.addEventListener("click",function(){console.log("click"),i(d.value)}),d.value="(+ 1 (* 2 3))",f.click();async function h(){const t=o.shift();return t?(await new Promise((e,n)=>{t(l?1:0),setTimeout(e,0)}),o.length):!1}r(h,"m"),a(h,"tick");async function i(t){s.print(`
> `+t+`
`),l=!1;const e=s.stringToNewUTF8(t);for(s._evaluate(e);await h(););s._free(e)}r(i,"r"),a(i,"run")})().catch(console.error)})();
